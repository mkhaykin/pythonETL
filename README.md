# ETL-потоки, Telegram bot, python

## 1. Задание ETL:
### Распарсить xlsx файл в БД.
Данные из excel парсим при помощи Pandas.

В качестве БД используется Postgres (отдельный docker контейнер).
Для корректной работы необходима настройка окружения, см. [Переменные среды](#переменные-среды)

Решение демонстрационное, поэтому база не выведена на отдельный volume и таблицы пересоздаются 
при каждом запуске приложения.
Загрузка данных также производится при каждом запуске программы, имя файла (дан по ТЗ) указано 
в [настройках](src/settings.py). 
Так же нет контроля отсутствия файла для загрузки и / или проблем с данными.

Порядок загрузки данных:
- сначала плоские данные кладем в таблицу overdue_import, имя таблицы задано в [настройках](src/settings.py);
- после уже в несколько нормализованном виде перекладываем данные в overdue.

### Создать телеграм-бота, настроить отправку xlsx файла.
/start - приветственное сообщение.  

/report - отправка отчета.

Любое другое сообщение - эхо-ответ.

При запуске бота предварительно пересоздается база и импортируются данные из xlsx. 


### Дополнительно
Решение упаковано в docker контейнеры:
- контейнер postgres;
- контейнер приложения.

## Переменные среды
Для запуска и тестирования проекта, требуется создать файл `.env` с переменными окружения.
Пример файла: [.env.example](.env.sample)

Параметры:
- `POSTGRES_HOST` - имя хоста;
- `POSTGRES_PORT` - порт;
- `POSTGRES_DB` - имя базы данных;
- `POSTGRES_USER` - пользователь;
- `POSTGRES_PASSWORD` - пароль;
- `TG_BOT_TOKEN` - токен бота.

## Проверка работы
Проверить телеграм бота можно по адресу: t.me/khaykin_bot
Это учебный проект, поэтому он self-hosted и может быть не доступен.

## Инструкция для развертывания (docker)
### 1. Клонируйте репозиторий:
```shell
git clone git@github.com:mkhaykin/pythonETL.git
```

### 2. Создайте файл .env с переменными окружения.
Пример файла: [.env.example](.env.sample). Подобнее в разделе см. [Переменные среды](#переменные-среды).

### 3. Запустите контейнеры.
```shell
docker compose up -d
```
